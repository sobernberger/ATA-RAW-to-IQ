# ATA-RAW-to-IQ

This is a Python script which converts the ATA's beamformer output to an IQ timeseries.
The RAW files are read using Wael Farahs [guppi package](https://github.com/wfarah/guppi), which also provides information from header files, such as: 
1. Channel Bandwidth 
2. Total Bandwidth
3. Center Frequency
4. Number of Samples per Spectrum
5. Time per Spectrum
6. Header Size

an example for a header is provided below.
```yaml
{
    'BACKEND': 'GUPPI',
    'INSTANCE': 1,
    'DATADIR': '/mnt/buf1',
    'BINDHOST': 'enp225s0f1',
    'HPCONFIG': 'IBV->FTP->BLADE->DISK',
    'PROJID': 'blade',
    'DIRECTIO': 1,
    'IBVPKTSZ': '42,16,8208',
    'CUDADEV': 1,
    'BINDPORT': 10000,
    'IBVSTAT': 'running',
    'MAXFLOWS': 16,
    'NETSTAT': 'receiving',
    'DAQSTATE': 'armed',
    'BLOCSIZE': 12582912,
    'NBITS': 16,
    'NPOL': 2,
    'OBSBW': 96,
    'CHAN_BW': 0.5,
    'OBSNCHAN': 192,
    'OVERLAP': 0,
    'PKTFMT': 'ATASNAPV',
    'TBIN': 2e-06,
    'OBS_MODE': 'RAW',
    'NDROP': 0,
    'PKTSTART': 27684500000,
    'PKTSTOP': 27714500000,
    'BEAMSTAT': 'beamforming',
    'OBSSTAT': 'processing',
    'STTVALID': 1,
    'OBSDONE': 0,
    'OBSNPKTS': 75018240,
    'OBSNDROP': 0,
    'OBSBLKPS': 61,
    'OBSBLKMS': 0.021519,
    'DAQPULSE': 'Tue Apr 19 17:34:14 2022',
    'BLDBLKSZ': 12582912,
    'BLDBUFST': '0/12',
    'BLDBLKMS': 8.571996689,
    'NETBUFST': '2/12',
    'OBSINFO': 'VALID',
    'FENCHAN': 2048,
    'NANTS': 20,
    'NCHAN': 192,
    'PKTNTIME': 16,
    'PKTNCHAN': 96,
    'SCHAN': 736,
    'PIPERBLK': 8192,
    'PKTSIZE': 6160,
    'IBVBUFST': '1/12',
    'NETTHRDS': 12,
    'NPKTS': 274949998,
    'PHYSPKPS': 1249981.5,
    'PHYSGBPS': 7.699885845,
    'RUSHBLKS': 58,
    'NETBLKPS': 84.820014954,
    'NETBLKMS': 4.642366886,
    'BLKIDX': 0,
    'PKTIDX': 27684500000,
    'BLKSTART': 27684500000,
    'BLKSTOP': 27684508192,
    'IBVGBPS': 62.018534,
    'IBVPPS': 1249970.451,
    'IBVBLKMS': 12.000255585,
    'OBSFREQ': 8403.75,
    'SYNCTIME': 1650334286,
    'SOURCE': 'mars',
    'RA': 335.6344525732259,
    'DEC': -11.664625247051491,
    'RA_STR': 335.6344525732259,
    'DEC_STR': -11.664625247051491,
    'AZ': 196.95370483398438,
    'EL': 36.09290313720703,
    'ANTNAMES': '1cB,1eB,1gB,1hB,1kB,2aB,2bB,2cB,2eB,2hB,2jB,2kB,2lB,2mB,4eB,3dB,3lB',
    'XPCTGBPS': '7.500GBps 60.000Gbps',
    'ANTNMS00': '1cB,1eB,1gB,1hB,1kB,2aB,2bB,2cB,2eB,2hB,2jB,2kB,2lB,2mB,4eB,3dB,3lB',
    'ANTNMS01': '4jB,5bB,4gB',
    'DUT1': -0.0987232,
    'SRC_NAME': 'mars',
    'STT_IMJD': 59688,
    'STT_SMJD': 63255,
    'STT_OFFS': 0,
    'OBSSTEM': 'guppi_59688_62411_3327941_mars_0001',
    'NPKT': 20480,
    'DROPSTAT': '0/20480',
    'NBEAMS': 1,
    'DATATYPE': 'FLOAT',
    'SMPLTYPE': 'CF16',
    'HEADER_SIZE': 7168
}

The IQ timesamples are generated by reading in a spectrum, and converting it to an IQ spectrum and then performing a FFT. The resulting timesamples are then saved to disc. This is repeated for the amount of blocks specified by the user.
![RAW Spectrum](BF_Spectrum_1960MHz.png)


# Example